<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fresh Grocery Store</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f8f9fa;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            padding: 1rem 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.8rem;
            font-weight: bold;
        }

        .nav-links {
            display: flex;
            gap: 2rem;
            align-items: center;
        }

        .btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn:hover {
            background: #45a049;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: transparent;
            border: 2px solid white;
        }

        .btn-secondary:hover {
            background: white;
            color: #4CAF50;
        }

        .cart-btn {
            position: relative;
        }

        .cart-count {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #ff4444;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Main Content */
        .main-content {
            padding: 2rem 0;
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        /* Hero Section */
      /* Hero Section */
.hero {
    background: linear-gradient(rgba(76, 175, 80, 0.9), rgba(69, 160, 73, 0.9)),
                url('https://images.unsplash.com/photo-1606788075761-7f8e6e9cf23d') center/cover no-repeat;
    color: #fff;
    padding: 6rem 2rem;
    text-align: center;
    margin-bottom: 3rem;
    border-radius: 15px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.2);
    animation: fadeIn 1s ease;
}

.hero h1 {
    font-size: clamp(2rem, 5vw, 3.5rem);
    margin-bottom: 1rem;
    font-weight: 700;
    letter-spacing: -0.5px;
    line-height: 1.2;
}

.hero p {
    font-size: 1.3rem;
    margin-bottom: 2.5rem;
    color: #eafbea;
    max-width: 650px;
    margin-left: auto;
    margin-right: auto;
}

/* Buttons inside hero */
.hero .btn {
    font-size: 1.1rem;
    padding: 1rem 2rem;
    border-radius: 30px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.15);
    transition: all 0.3s ease;
}

.hero .btn:hover {
    transform: translateY(-3px) scale(1.05);
}

/* Improve product card hover */
.product-card {
    background: #fff;
    border-radius: 15px;
    overflow: hidden;
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    transition: all 0.3s ease;
}

.product-card:hover {
    transform: translateY(-6px);
    box-shadow: 0 10px 25px rgba(0,0,0,0.15);
}

/* Form inputs consistency */
.form-group input, 
.form-group textarea, 
.form-group select {
    background: #fdfdfd;
    transition: border-color 0.3s ease, box-shadow 0.3s ease;
}

.form-group input:focus, 
.form-group textarea:focus, 
.form-group select:focus {
    border-color: #45a049;
    box-shadow: 0 0 0 3px rgba(76,175,80,0.2);
}


        /* Search and Filter */
        .search-filter {
            background: white;
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            align-items: center;
        }

        .search-box, .filter-select {
            flex: 1;
            min-width: 200px;
            padding: 0.8rem;
            border: 2px solid #ddd;
            border-radius: 25px;
            font-size: 1rem;
        }

        .search-box:focus, .filter-select:focus {
            outline: none;
            border-color: #4CAF50;
        }

        /* Products Grid */
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 2rem;
            margin: 2rem 0;
        }

        .product-card {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .product-card:hover {
            transform: translateY(-5px);
        }

        .product-image {
            width: 100%;
            height: 200px;
            background: linear-gradient(45deg, #4CAF50, #45a049);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 3rem;
        }

        .product-info {
            padding: 1.5rem;
        }

        .product-name {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
            color: #333;
        }

        .product-description {
            color: #666;
            margin-bottom: 1rem;
            font-size: 0.9rem;
        }

        .product-price {
            font-size: 1.5rem;
            font-weight: bold;
            color: #4CAF50;
            margin-bottom: 1rem;
        }

        .product-actions {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .quantity-input {
            width: 60px;
            padding: 0.5rem;
            border: 2px solid #ddd;
            border-radius: 5px;
            text-align: center;
        }

        /* Cart */
        .cart-items {
            background: white;
            border-radius: 10px;
            padding: 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .cart-item {
            display: flex;
            align-items: center;
            padding: 1rem 0;
            border-bottom: 1px solid #eee;
        }

        .cart-item:last-child {
            border-bottom: none;
        }

        .cart-item-info {
            flex: 1;
        }

        .cart-item-name {
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .cart-item-price {
            color: #4CAF50;
            font-weight: bold;
        }

        .cart-total {
            text-align: right;
            font-size: 1.5rem;
            font-weight: bold;
            color: #4CAF50;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 2px solid #4CAF50;
        }

        /* Forms */
        .form-container {
            max-width: 500px;
            margin: 0 auto;
            background: white;
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: bold;
            color: #333;
        }

        .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            padding: 0.8rem;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
        }

        .form-group input:focus, .form-group textarea:focus, .form-group select:focus {
            outline: none;
            border-color: #4CAF50;
        }

        /* Admin Panel */
        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .admin-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: white;
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #4CAF50;
        }

        .stat-label {
            color: #666;
            margin-top: 0.5rem;
        }

        /* Orders */
        .order-card {
            background: white;
            padding: 1.5rem;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 1rem;
        }

        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .order-status {
            padding: 0.25rem 0.8rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
            text-transform: uppercase;
        }

        .order-status.pending { background: #fff3cd; color: #856404; }
        .order-status.confirmed { background: #d4edda; color: #155724; }
        .order-status.shipped { background: #cce5ff; color: #004085; }
        .order-status.delivered { background: #d1ecf1; color: #0c5460; }

        /* Responsive */
        @media (max-width: 768px) {
            .nav-links {
                gap: 1rem;
            }
            
            .hero h1 {
                font-size: 2rem;
            }
            
            .search-filter {
                flex-direction: column;
            }
            
            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 0.5s ease;
        }

        /* Loading spinner */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 2rem;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #4CAF50;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .hidden {
            display: none !important;
        }

        .error {
            color: #ff4444;
            background: #ffe6e6;
            padding: 0.5rem;
            border-radius: 5px;
            margin: 0.5rem 0;
        }

        .success {
            color: #4CAF50;
            background: #e8f5e8;
            padding: 0.5rem;
            border-radius: 5px;
            margin: 0.5rem 0;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <nav class="nav container">
            <div class="logo">
                <i class="fas fa-shopping-basket"></i> OM SAIRAM
            </div>
            <div class="nav-links">
                <a href="#" class="btn btn-secondary" onclick="showPage('home')">
                    <i class="fas fa-home"></i> Home
                </a>
                <a href="#" class="btn btn-secondary cart-btn" onclick="showPage('cart')">
                    <i class="fas fa-shopping-cart"></i> Cart
                    <span class="cart-count" id="cartCount">0</span>
                </a>
                <div id="authButtons">
                    <a href="#" class="btn btn-secondary" onclick="showPage('login')">Login</a>
                    <a href="#" class="btn" onclick="showPage('register')">Register</a>
                </div>
                <div id="userButtons" class="hidden">
                    <span id="userName"></span>
                    <a href="#" class="btn btn-secondary" onclick="showPage('orders')">Orders</a>
                    <a href="#" class="btn btn-secondary" id="adminBtn" onclick="showPage('admin')" style="display: none;">Admin</a>
                    <a href="#" class="btn" onclick="logout()">Logout</a>
                </div>
            </div>
        </nav>
    </header>

    <!-- Main Content -->
    <main class="main-content container">
        <!-- Home Page -->
        <div id="home" class="page active">
            <div class="hero">
                <h1>Fresh Groceries, Ready When You Are</h1>
<p>Skip the wait — order online and pick up from home or store</p>

                <button class="btn" onclick="document.getElementById('searchBox').focus()">
                    <i class="fas fa-search"></i> Shop Now
                </button>
            </div>

            <div class="search-filter">
                <input type="text" id="searchBox" class="search-box" placeholder="Search products..." oninput="searchProducts()">
                <select id="categoryFilter" class="filter-select" onchange="filterProducts()">
                    <option value="">All Categories</option>
                    <option value="fruits">Fruits</option>
                    <option value="vegetables">Vegetables</option>
                    <option value="dairy">Dairy</option>
                    <option value="meat">Meat</option>
                    <option value="grains">Grains</option>
                    <option value="beverages">Beverages</option>
                    <option value="snacks">Snacks</option>
                </select>
            </div>

            <div id="productsLoading" class="loading">
                <div class="spinner"></div>
            </div>

            <div id="productsGrid" class="products-grid"></div>
        </div>

        <!-- Cart Page -->
        <div id="cart" class="page">
            <h2>Shopping Cart</h2>
            <div id="cartItems" class="cart-items">
                <p>Your cart is empty</p>
            </div>
        </div>

        <!-- Login Page -->
        <div id="login" class="page">
            <div class="form-container">
                <h2>Login</h2>
                <form id="loginForm" onsubmit="handleLogin(event)">
                    <div class="form-group">
                        <label for="loginEmail">Email</label>
                        <input type="email" id="loginEmail" required>
                    </div>
                    <div class="form-group">
                        <label for="loginPassword">Password</label>
                        <input type="password" id="loginPassword" required>
                    </div>
                    <button type="submit" class="btn" style="width: 100%;">
                        <i class="fas fa-sign-in-alt"></i> Login
                    </button>
                </form>
                <div id="loginError" class="error hidden"></div>
            </div>
        </div>

        <!-- Register Page -->
        <div id="register" class="page">
            <div class="form-container">
                <h2>Register</h2>
                <form id="registerForm" onsubmit="handleRegister(event)">
                    <div class="form-group">
                        <label for="registerName">Full Name</label>
                        <input type="text" id="registerName" required>
                    </div>
                    <div class="form-group">
                        <label for="registerEmail">Email</label>
                        <input type="email" id="registerEmail" required>
                    </div>
                    <div class="form-group">
                        <label for="registerPassword">Password</label>
                        <input type="password" id="registerPassword" required minlength="6">
                    </div>
                    <div class="form-group">
                        <label for="registerPhone">Phone</label>
                        <input type="tel" id="registerPhone" required>
                    </div>
                    <div class="form-group">
                        <label for="registerAddress">Address</label>
                        <textarea id="registerAddress" rows="3" required></textarea>
                    </div>
                    <button type="submit" class="btn" style="width: 100%;">
                        <i class="fas fa-user-plus"></i> Register
                    </button>
                </form>
                <div id="registerError" class="error hidden"></div>
                <div id="registerSuccess" class="success hidden"></div>
            </div>
        </div>

        <!-- Orders Page -->
        <div id="orders" class="page">
            <h2>My Orders</h2>
            <div id="ordersLoading" class="loading hidden">
                <div class="spinner"></div>
            </div>
            <div id="ordersList"></div>
        </div>

        <!-- Admin Page -->
        <div id="admin" class="page">
            <div class="admin-header">
                <h2>Admin Panel</h2>
                <button class="btn" onclick="showAddProductForm()">
                    <i class="fas fa-plus"></i> Add Product
                </button>
            </div>

            <div class="admin-stats">
                <div class="stat-card">
                    <div class="stat-number" id="totalProducts">0</div>
                    <div class="stat-label">Total Products</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalOrders">0</div>
                    <div class="stat-label">Total Orders</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="pendingOrders">0</div>
                    <div class="stat-label">Pending Orders</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalRevenue">₹0</div>
                    <div class="stat-label">Total Revenue</div>
                </div>
            </div>

            <div id="addProductForm" class="form-container hidden">
                <h3>Add New Product</h3>
                <form id="productForm" onsubmit="handleAddProduct(event)">
                    <div class="form-group">
                        <label for="productName">Product Name</label>
                        <input type="text" id="productName" required>
                    </div>
                    <div class="form-group">
                        <label for="productDescription">Description</label>
                        <textarea id="productDescription" rows="3" required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="productPrice">Price (₹)</label>
                        <input type="number" id="productPrice" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label for="productCategory">Category</label>
                        <select id="productCategory" required>
                            <option value="">Select Category</option>
                            <option value="fruits">Fruits</option>
                            <option value="vegetables">Vegetables</option>
                            <option value="dairy">Dairy</option>
                            <option value="meat">Meat</option>
                            <option value="grains">Grains</option>
                            <option value="beverages">Beverages</option>
                            <option value="snacks">Snacks</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="productStock">Stock</label>
                        <input type="number" id="productStock" required>
                    </div>
                    <div class="form-group">
                        <label for="productUnit">Unit</label>
                        <select id="productUnit" required>
                            <option value="">Select Unit</option>
                            <option value="kg">Kilogram</option>
                            <option value="piece">Piece</option>
                            <option value="liter">Liter</option>
                            <option value="pack">Pack</option>
                        </select>
                    </div>
                    <button type="submit" class="btn" style="width: 100%;">
                        <i class="fas fa-save"></i> Add Product
                    </button>
                    <button type="button" class="btn btn-secondary" style="width: 100%; margin-top: 10px;" onclick="hideAddProductForm()">
                        Cancel
                    </button>
                </form>
            </div>

            <div id="adminOrdersList">
                <h3>Recent Orders</h3>
                <div id="adminOrdersContent"></div>
            </div>
        </div>
    </main>

    <script>
        // Global variables
        let products = [];
        let cart = JSON.parse(localStorage.getItem('cart')) || [];
        let currentUser = JSON.parse(localStorage.getItem('currentUser')) || null;
        let token = localStorage.getItem('token') || null;

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            updateAuthUI();
            updateCartCount();
            loadProducts();
            
            if (currentUser && currentUser.role === 'admin') {
                document.getElementById('adminBtn').style.display = 'inline-flex';
            }
        });

        // API Base URL
        const API_BASE = '/api';

        // Utility functions
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            document.getElementById(pageId).classList.add('active');
            
            if (pageId === 'orders' && currentUser) {
                loadUserOrders();
            } else if (pageId === 'admin' && currentUser && currentUser.role === 'admin') {
                loadAdminData();
            }
        }

        function updateAuthUI() {
            const authButtons = document.getElementById('authButtons');
            const userButtons = document.getElementById('userButtons');
            const userName = document.getElementById('userName');
            
            if (currentUser) {
                authButtons.classList.add('hidden');
                userButtons.classList.remove('hidden');
                userName.textContent = `Hello, ${currentUser.name}`;
            } else {
                authButtons.classList.remove('hidden');
                userButtons.classList.add('hidden');
            }
        }

        function updateCartCount() {
            const cartCount = document.getElementById('cartCount');
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            cartCount.textContent = totalItems;
        }

        // Product functions
        async function loadProducts() {
            try {
                document.getElementById('productsLoading').style.display = 'flex';
                const response = await fetch(`${API_BASE}/products`);
                products = await response.json();
                displayProducts(products);
            } catch (error) {
                console.error('Error loading products:', error);
            } finally {
                document.getElementById('productsLoading').style.display = 'none';
            }
        }

        function displayProducts(productsToShow) {
            const grid = document.getElementById('productsGrid');
            grid.innerHTML = '';
            
            productsToShow.forEach(product => {
                const productCard = document.createElement('div');
                productCard.className = 'product-card fade-in';
                productCard.innerHTML = `
                    <div class="product-image">
                        <i class="fas fa-${getProductIcon(product.category)}"></i>
                    </div>
                    <div class="product-info">
                        <div class="product-name">${product.name}</div>
                        <div class="product-description">${product.description}</div>
                        <div class="product-price">₹${product.price}/${product.unit}</div>
                        <div class="product-stock">Stock: ${product.stock} ${product.unit}</div>
                        <div class="product-actions">
                            <input type="number" class="quantity-input" min="1" max="${product.stock}" value="1" id="qty-${product._id}">
                            <button class="btn" onclick="addToCart('${product._id}')" ${product.stock === 0 ? 'disabled' : ''}>
                                <i class="fas fa-cart-plus"></i> Add to Cart
                            </button>
                        </div>
                    </div>
                `;
                grid.appendChild(productCard);
            });
        }

        function getProductIcon(category) {
            const icons = {
                fruits: 'apple-alt',
                vegetables: 'carrot',
                dairy: 'cheese',
                meat: 'drumstick-bite',
                grains: 'seedling',
                beverages: 'coffee',
                snacks: 'cookie'
            };
            return icons[category] || 'shopping-bag';
        }

        function searchProducts() {
            const searchTerm = document.getElementById('searchBox').value.toLowerCase();
            const category = document.getElementById('categoryFilter').value;
            
            let filteredProducts = products.filter(product => {
                const matchesSearch = product.name.toLowerCase().includes(searchTerm) || 
                                    product.description.toLowerCase().includes(searchTerm);
                const matchesCategory = !category || product.category === category;
                return matchesSearch && matchesCategory;
            });
            
            displayProducts(filteredProducts);
        }

        function filterProducts() {
            searchProducts(); // Reuse search logic
        }

        // Cart functions
        function addToCart(productId) {
            const product = products.find(p => p._id === productId);
            const quantity = parseInt(document.getElementById(`qty-${productId}`).value);
            
            if (!product || quantity <= 0 || quantity > product.stock) {
                alert('Invalid quantity');
                return;
            }
            
            const existingItem = cart.find(item => item.productId === productId);
            
            if (existingItem) {
                existingItem.quantity += quantity;
            } else {
                cart.push({
                    productId: productId,
                    name: product.name,
                    price: product.price,
                    quantity: quantity,
                    unit: product.unit
                });
            }
            
            localStorage.setItem('cart', JSON.stringify(cart));
            updateCartCount();
            updateCartDisplay();
            
            // Show success message
            alert(`${product.name} added to cart!`);
        }

        function updateCartDisplay() {
            const cartItems = document.getElementById('cartItems');
            
            if (cart.length === 0) {
                cartItems.innerHTML = '<p>Your cart is empty</p>';
                return;
            }
            
            let total = 0;
            let cartHTML = '';
            
            cart.forEach(item => {
                const itemTotal = item.price * item.quantity;
                total += itemTotal;
                
                cartHTML += `
                    <div class="cart-item">
                        <div class="cart-item-info">
                            <div class="cart-item-name">${item.name}</div>
                            <div class="cart-item-price">₹${item.price}/${item.unit} × ${item.quantity} = ₹${itemTotal.toFixed(2)}</div>
                        </div>
                        <button class="btn btn-secondary" onclick="removeFromCart('${item.productId}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
            });
            
            cartHTML += `
                <div class="cart-total">
                    Total: ₹${total.toFixed(2)}
                </div>
                <button class="btn" style="width: 100%; margin-top: 1rem;" onclick="checkout()">
                    <i class="fas fa-credit-card"></i> Checkout
                </button>
            `;
            
            cartItems.innerHTML = cartHTML;
        }

        function removeFromCart(productId) {
            cart = cart.filter(item => item.productId !== productId);
            localStorage.setItem('cart', JSON.stringify(cart));
            updateCartCount();
            updateCartDisplay();
        }

        async function checkout() {
            if (!currentUser) {
                alert('Please login to place an order');
                showPage('login');
                return;
            }
            
            if (cart.length === 0) {
                alert('Your cart is empty');
                return;
            }
            
            const deliveryAddress = prompt('Enter delivery address:');
            if (!deliveryAddress) return;
            
            try {
                const response = await fetch(`${API_BASE}/orders`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        items: cart,
                        deliveryAddress: { street: deliveryAddress }
                    })
                });
                
                if (response.ok) {
                    cart = [];
                    localStorage.setItem('cart', JSON.stringify(cart));
                    updateCartCount();
                    updateCartDisplay();
                    alert('Order placed successfully!');
                    showPage('orders');
                } else {
                    const error = await response.json();
                    alert(`Error: ${error.message}`);
                }
            } catch (error) {
                console.error('Checkout error:', error);
                alert('Error placing order');
            }
        }

        // Authentication functions
        async function handleLogin(event) {
            event.preventDefault();
            
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            try {
                const response = await fetch(`${API_BASE}/users/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    currentUser = data.user;
                    token = data.token;
                    localStorage.setItem('currentUser', JSON.stringify(currentUser));
                    localStorage.setItem('token', token);
                    updateAuthUI();
                    
                    if (currentUser.role === 'admin') {
                        document.getElementById('adminBtn').style.display = 'inline-flex';
                    }
                    
                    showPage('home');
                } else {
                    document.getElementById('loginError').textContent = data.message;
                    document.getElementById('loginError').classList.remove('hidden');
                }
            } catch (error) {
                console.error('Login error:', error);
                document.getElementById('loginError').textContent = 'Login failed';
                document.getElementById('loginError').classList.remove('hidden');
            }
        }

        async function handleRegister(event) {
            event.preventDefault();
            
            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const phone = document.getElementById('registerPhone').value;
            const address = document.getElementById('registerAddress').value;
            
            try {
                const response = await fetch(`${API_BASE}/users/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        name, email, password, phone,
                        address: { street: address }
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    document.getElementById('registerSuccess').textContent = 'Registration successful! Please login.';
                    document.getElementById('registerSuccess').classList.remove('hidden');
                    document.getElementById('registerForm').reset();
                    setTimeout(() => showPage('login'), 2000);
                } else {
                    document.getElementById('registerError').textContent = data.message;
                    document.getElementById('registerError').classList.remove('hidden');
                }
            } catch (error) {
                console.error('Registration error:', error);
                document.getElementById('registerError').textContent = 'Registration failed';
                document.getElementById('registerError').classList.remove('hidden');
            }
        }

        function logout() {
            currentUser = null;
            token = null;
            localStorage.removeItem('currentUser');
            localStorage.removeItem('token');
            document.getElementById('adminBtn').style.display = 'none';
            updateAuthUI();
            showPage('home');
        }

        // Orders functions
        async function loadUserOrders() {
            if (!token) return;
            
            try {
                document.getElementById('ordersLoading').classList.remove('hidden');
                const response = await fetch(`${API_BASE}/orders`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                const orders = await response.json();
                displayOrders(orders);
            } catch (error) {
                console.error('Error loading orders:', error);
            } finally {
                document.getElementById('ordersLoading').classList.add('hidden');
            }
        }

        function displayOrders(orders) {
            const ordersList = document.getElementById('ordersList');
            
            if (orders.length === 0) {
                ordersList.innerHTML = '<p>No orders found</p>';
                return;
            }
            
            ordersList.innerHTML = orders.map(order => `
                <div class="order-card">
                    <div class="order-header">
                        <h3>Order #${order._id.slice(-6)}</h3>
                        <span class="order-status ${order.status}">${order.status}</span>
                    </div>
                    <div class="order-items">
                        ${order.items.map(item => `
                            <div>${item.product.name} × ${item.quantity} = ₹${(item.price * item.quantity).toFixed(2)}</div>
                        `).join('')}
                    </div>
                    <div class="order-total">Total: ₹${order.totalAmount.toFixed(2)}</div>
                    <div class="order-date">Ordered on: ${new Date(order.createdAt).toLocaleDateString()}</div>
                </div>
            `).join('');
        }

        // Admin functions
        function showAddProductForm() {
            document.getElementById('addProductForm').classList.remove('hidden');
        }

        function hideAddProductForm() {
            document.getElementById('addProductForm').classList.add('hidden');
            document.getElementById('productForm').reset();
        }

        async function handleAddProduct(event) {
            event.preventDefault();
            
            const formData = {
                name: document.getElementById('productName').value,
                description: document.getElementById('productDescription').value,
                price: parseFloat(document.getElementById('productPrice').value),
                category: document.getElementById('productCategory').value,
                stock: parseInt(document.getElementById('productStock').value),
                unit: document.getElementById('productUnit').value
            };
            
            try {
                const response = await fetch(`${API_BASE}/products`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify(formData)
                });
                
                if (response.ok) {
                    alert('Product added successfully!');
                    hideAddProductForm();
                    loadProducts();
                    loadAdminData();
                } else {
                    const error = await response.json();
                    alert(`Error: ${error.message}`);
                }
            } catch (error) {
                console.error('Error adding product:', error);
                alert('Error adding product');
            }
        }

        async function loadAdminData() {
            if (!token || currentUser.role !== 'admin') return;
            
            try {
                // Load products count
                const productsResponse = await fetch(`${API_BASE}/products`);
                const products = await productsResponse.json();
                document.getElementById('totalProducts').textContent = products.length;
                
                // Load orders
                const ordersResponse = await fetch(`${API_BASE}/orders/all`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const orders = await ordersResponse.json();
                
                document.getElementById('totalOrders').textContent = orders.length;
                document.getElementById('pendingOrders').textContent = 
                    orders.filter(order => order.status === 'pending').length;
                
                const totalRevenue = orders.reduce((sum, order) => sum + order.totalAmount, 0);
                document.getElementById('totalRevenue').textContent = `₹${totalRevenue.toFixed(2)}`;
                
                // Display recent orders
                displayAdminOrders(orders.slice(0, 10));
            } catch (error) {
                console.error('Error loading admin data:', error);
            }
        }

        function displayAdminOrders(orders) {
            const ordersContent = document.getElementById('adminOrdersContent');
            
            if (orders.length === 0) {
                ordersContent.innerHTML = '<p>No orders found</p>';
                return;
            }
            
            ordersContent.innerHTML = orders.map(order => `
                <div class="order-card">
                    <div class="order-header">
                        <h4>Order #${order._id.slice(-6)}</h4>
                        <span class="order-status ${order.status}">${order.status}</span>
                    </div>
                    <div>Customer: ${order.user.name} (${order.user.email})</div>
                    <div>Total: ₹${order.totalAmount.toFixed(2)}</div>
                    <div>Date: ${new Date(order.createdAt).toLocaleDateString()}</div>
                    <div style="margin-top: 10px;">
                        <select onchange="updateOrderStatus('${order._id}', this.value)">
                            <option value="pending" ${order.status === 'pending' ? 'selected' : ''}>Pending</option>
                            <option value="confirmed" ${order.status === 'confirmed' ? 'selected' : ''}>Confirmed</option>
                            <option value="shipped" ${order.status === 'shipped' ? 'selected' : ''}>Shipped</option>
                            <option value="delivered" ${order.status === 'delivered' ? 'selected' : ''}>Delivered</option>
                        </select>
                    </div>
                </div>
            `).join('');
        }

        async function updateOrderStatus(orderId, status) {
            try {
                const response = await fetch(`${API_BASE}/orders/${orderId}/status`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ status })
                });
                
                if (response.ok) {
                    alert('Order status updated successfully!');
                    loadAdminData();
                } else {
                    alert('Error updating order status');
                }
            } catch (error) {
                console.error('Error updating order status:', error);
                alert('Error updating order status');
            }
        }

        // Initialize cart display when cart page is shown
        document.addEventListener('DOMContentLoaded', function() {
            updateCartDisplay();
        });
    </script>
</body>
</html>